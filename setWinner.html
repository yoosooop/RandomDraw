<!DOCTYPE html>
<html>
  <head>
    <title>SOPT-DEMODAY ì´ë²¤íŠ¸ ë‹¹ì²¨ì ë½‘ê¸°</title>
    <script src="js/jquery-3.4.1.js"></script>
    <script src="js/xlsx.full.min.js"></script>
    <script src="js/jszip.js"></script>
    <script src="js/tableToExcel.js"></script>
    <link rel="stylesheet" href="style.css" />
    <script src="index.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bttn.css/0.2.4/bttn.min.css"
      integrity="sha512-/2285SnGiTHjSKBkJzedsJ8wwSP0j74ZQyusMQ9j5Z1RtyKqZ3XtfS8hVp8OadLs2uq+8V6/n+CyqUNTO/UpYg=="
      crossorigin="anonymous"
    />
  </head>

  <body>
    <div class="card">
      <div class="filebox">
        <span> <h2>SOPT-DEMODAY ì°¸ì—¬ ëª…ë‹¨ [ì´ë²¤í„°ìŠ¤]</h2> </span>
        <h6>ë³¸ ëª…ë‹¨ì€ ì´ë²¤í„°ìŠ¤ ì°¸ì—¬ì ë°”íƒ•ìœ¼ë¡œ ì˜¤ëŠ˜ ì°¸ì„í•œ ì¸ì› íŒŒì¼ì…ë‹ˆë‹¤.</h6>
        <!-- <hr /> -->
        <input class="upload-name" value="íŒŒì¼ì„ íƒ" disabled="disabled" />
        <label for="fileUpload">íŒŒì¼ ì—…ë¡œë“œ</label>
        <input type="file" id="fileUpload" class="upload-hidden" />
        <input
          type="button"
          id="upload"
          value="í…Œì´ë¸” ë“±ë¡"
          onclick="Upload();"
          class="upload-name"
        />
      </div>
    </div>
    <br /><br /><br /><br />
    <div class="card">
      <span> <h2>â¤ï¸ ì´ë²¤íŠ¸ ìƒí’ˆ â¤ï¸</h2> </span>
      <!-- <hr /> -->
      <!-- ìƒí’ˆ : <input type="text" id="prizeName" /> -->
      <div class="input--akira">
        <span class="input input--akira">
          <input
            class="input__field input__field--akira"
            type="text"
            id="prizeName"
          />
          <label class="input__label input__label--akira" for="input-1">
            <span class="input__label-content input__label-content--akira"
              >ìƒí’ˆëª…</span
            >
          </label>
        </span>
      </div>
      <br />

      <input
        type="button"
        value=" + 1 "
        id="addPrize1"
        class="bttn-jelly bttn-sm bttn-danger"
      />

      <input
        type="button"
        value="+ 5"
        id="addPrize5"
        class="bttn-jelly bttn-sm bttn-danger"
      />
      <input
        type="button"
        value="+ 20"
        id="addPrize20"
        class="bttn-jelly bttn-sm bttn-danger"
      />
      <!-- <input
        type="button"
        value="ìƒí’ˆ ì¶”ê°€(+100)"
        id="addPrize100"
        class="btn"
      /> -->
      <input
        type="button"
        value="delete"
        id="delPrize"
        class="bttn-jelly bttn-sm bttn-danger"
      />
    </div>
    <br /><br /><br /><br />

    <div class="card">
      <span> <h2>ğŸ¥³ ë‘ê·¼ë‘ê·¼ ìƒí’ˆ ì¶”ì²¨ ğŸ¥³</h2></span>
      <br />
      <!-- <hr /> -->
      <input
        type="button"
        value="START"
        id="setWinner"
        class="bttn-unite bttn-md bttn-danger"
      />
    </div>

    <br /><br /><br />

    <br />
    <div class="card">
      <span><h2>ì´ë²¤íŠ¸ ê²°ê³¼</h2></span>
      <!-- <hr /> -->
      <table cellspacing="0" id="prizeTable">
        <tr id="tableHeader">
          <th>ë²ˆí˜¸</th>
          <th>ìƒí’ˆëª…</th>
        </tr>
        <tbody></tbody>
      </table>
    </div>

    <br /><br /><br /><br />

    <div class="card">
      <span><h4>-- ì¶”ì²¨ ê²°ê³¼ ì €ì¥í•˜ê¸° --</h4></span>
      <!-- <hr /> -->
      <input
        type="button"
        value="ì¶”ì²¨ ê²°ê³¼ ì €ì¥"
        id="saveWinner"
        class="bttn-bordered bttn-xs bttn-danger"
      />
    </div>

    <br /><br /><br /><br />

    <div class="card">
      <span><h4>-- ì¶”ì²¨ ê²°ê³¼ ë¦¬ì…‹í•˜ê¸° --</h4></span>
      <!-- <hr /> -->
      <input
        type="button"
        value="ì¶”ì²¨ ê²°ê³¼ ë¦¬ì…‹"
        id="resetWinner"
        class="bttn-bordered bttn-xs bttn-danger"
      />
    </div>
    <br /><br /><br /><br />
    <button class="bttn-minimal bttn-xs bttn-warning">extraSmall</button>
    <button class="bttn-bordered bttn-xs bttn-warning">extraSmall</button>
    <button class="bttn-bordered bttn-sm bttn-warning">small</button>
    <button class="bttn-material-flat bttn-sm bttn-warning">small</button>
    <button class="bttn-pill bttn-sm bttn-warning">small</button>
    <button class="bttn-fill bttn-md bttn-primary">medium</button>
    <button class="bttn-jelly bttn-sm bttn-danger">small</button>
    <button class="bttn-pill bttn-md bttn-danger">medium</button>
    <button class="bttn-unite bttn-md bttn-danger">medium</button>
    <br /><br /><br /><br />

    <script>
      /**
       *
       * @Author Developer SaintPark
       * @Blog https://developersp.tistory.com/15
       * - í”„ë¡œê·¸ë¨ì— ëŒ€í•œ ë¬¸ì˜ëŠ” ë¸”ë¡œê·¸ ëŒ“ê¸€ì„ í™œìš©í•´ì£¼ì„¸ìš”.
       *
       */

      // ì‘ëª¨ ë‚´ì—­ì—ì„œ ë¹ˆì¹¸ì€ ì—†ì–´ì•¼ í•©ë‹ˆë‹¤.(ë¹ˆì¹¸ì´ ìˆìœ¼ë©´ ì¸ì‹í•˜ì§€ ëª»í•¨. ì—‘ì…€ì—ì„œ ë¹ˆì¹¸ì„ - ë“±ìœ¼ë¡œ ì±„ìš°ëŠ” ì‘ì—… í›„ ì§„í–‰í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.)
      // í•œë²ˆ ì¶”ì²¨ì´ ì™„ë£Œë˜ë©´ ë˜ë©´ ì¶”ì²œ ë¦¬ì…‹ ë²„íŠ¼ í´ë¦­ or ìƒˆë¡œê³ ì¹¨ ì´ì „ê¹Œì§€ ì¬ì¶”ì²¨ ë° ë‚´ìš© ìˆ˜ì •ì´ ì•ˆë©ë‹ˆë‹¤.

      var inExcelJSON;
      var prizeIndex = 0;
      var prizeTable = $("#prizeTable");
      var winnerArray = new Array();
      var winnerField = new Array();
      var isPrize = 0;

      function Upload() {
        if (isPrize != 0) {
          return;
        }

        //Reference the FileUpload element.
        var fileUpload = document.getElementById("fileUpload");

        //Validate whether File is valid Excel file.
        var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.xls|.xlsx)$/;
        if (regex.test(fileUpload.value.toLowerCase())) {
          if (typeof FileReader != "undefined") {
            var reader = new FileReader();

            //For Browsers other than IE.
            if (reader.readAsBinaryString) {
              reader.onload = function (e) {
                ProcessExcel(e.target.result);
                jsSetPrizeToTable();
              };
              reader.readAsBinaryString(fileUpload.files[0]);
            } else {
              //For IE Browser.
              reader.onload = function (e) {
                var data = "";
                var bytes = new Uint8Array(e.target.result);
                for (var i = 0; i < bytes.byteLength; i++) {
                  data += String.fromCharCode(bytes[i]);
                }
                ProcessExcel(data);
                jsSetPrizeToTable();
              };
              reader.readAsArrayBuffer(fileUpload.files[0]);
            }
          } else {
            alert("HTML5ë¥¼ ì§€ì›í•˜ëŠ” ë¸Œë¼ìš°ì €ë¡œ ì‚¬ìš©í•´ì£¼ì„¸ìš”.");
          }
        } else {
          alert("ìœ íš¨í•œ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.");
        }
      }

      function jsSetPrizeToTable() {
        winnerField = Object.keys(inExcelJSON[0]);

        for (var i = 0; i < winnerField.length; i++) {
          $("#tableHeader").append("<th>" + winnerField[i] + "</th>");
        }
      }

      function ProcessExcel(data) {
        //Read the Excel File data.
        var workbook = XLSX.read(data, {
          type: "binary",
        });

        //Fetch the name of First Sheet.
        var firstSheet = workbook.SheetNames[0];

        //Read all rows from First Sheet into an JSON array.
        var excelRows = XLSX.utils.sheet_to_row_object_array(
          workbook.Sheets[firstSheet]
        );

        inExcelJSON = excelRows;
      }

      $(function () {
        // ìƒí’ˆ ì¶”ê°€ í´ë¦­ì‹œ í…Œì´ë¸”ì— ìƒí’ˆ ì¶”ê°€
        $("#addPrize1").click(function () {
          if (isPrize != 0) {
            return;
          }

          var prizeName = $("#prizeName").val();

          if (prizeName == "" || prizeName == null) {
            alert("ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”!");
            return;
          }

          $("#prizeTable > tbody:last").append(
            '<tr class="setWinnerTr"><td>' +
              prizeIndex +
              "</td><td>" +
              prizeName +
              "</td></tr>"
          );
          prizeIndex++;
        });

        $("#addPrize5").click(function () {
          if (isPrize != 0) {
            return;
          }

          var prizeName = $("#prizeName").val();

          if (prizeName == "" || prizeName == null) {
            alert("ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”!");
            return;
          }

          for (var i = 0; i < 5; i++) {
            $("#prizeTable > tbody:last").append(
              '<tr class="setWinnerTr"><td>' +
                prizeIndex +
                "</td><td>" +
                prizeName +
                "</td></tr>"
            );
            prizeIndex++;
          }
        });

        $("#addPrize20").click(function () {
          if (isPrize != 0) {
            return;
          }

          var prizeName = $("#prizeName").val();

          if (prizeName == "" || prizeName == null) {
            alert("ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”!");
            return;
          }

          for (var i = 0; i < 20; i++) {
            $("#prizeTable > tbody:last").append(
              '<tr class="setWinnerTr"><td>' +
                prizeIndex +
                "</td><td>" +
                prizeName +
                "</td></tr>"
            );
            prizeIndex++;
          }
        });

        $("#addPrize100").click(function () {
          if (isPrize != 0) {
            return;
          }

          var prizeName = $("#prizeName").val();

          if (prizeName == "" || prizeName == null) {
            alert("ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”!");
            return;
          }

          for (var i = 0; i < 100; i++) {
            $("#prizeTable > tbody:last").append(
              '<tr class="setWinnerTr"><td>' +
                prizeIndex +
                "</td><td>" +
                prizeName +
                "</td></tr>"
            );
            prizeIndex++;
          }
        });

        // ìƒí’ˆ ì‚­ì œ
        $("#delPrize").click(function () {
          if (isPrize != 0) {
            return;
          }

          $("#prizeTable > tbody:last > tr:last").remove();
          if (prizeIndex > 0) {
            prizeIndex--;
          }
        });

        // ìƒí’ˆ ì¶”ì²¨
        $("#setWinner").click(function () {
          jsSetWinner();
        });

        $("#saveWinner").click(function () {
          if (isPrize != 1) {
            alert("ë¨¼ì € ì¶”ì²¨ì„ ì‹œì‘í•˜ì„¸ìš”");
            return;
          }

          TableToExcel.convert(document.getElementById("prizeTable"));
        });

        $("#resetWinner").click(function () {
          if (confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            location.reload();
          }
        });
      });

      function jsSetWinner() {
        if (isPrize != 0) {
          return;
        }
        $("td.winnerTd").text("");

        winnerArray = [];
        var applyNum;

        if (prizeIndex < 1) {
          alert("ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.");
          return false;
        }

        if (inExcelJSON === undefined) {
          alert("ì—‘ì…€ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.");
          return false;
        } else {
          applyNum = inExcelJSON.length;
        }

        isPrize = 1;

        var setMaxCnt = prizeIndex > applyNum ? applyNum : prizeIndex;

        for (var i = 0; i < setMaxCnt; ) {
          var randomNum = makeRandom(parseInt(applyNum));
          if (checkDuple(winnerArray, randomNum)) {
            winnerArray.push(randomNum);
            i++;
          }
        }

        $("tr.setWinnerTr").each(function (index, item) {
          var tmpString = "";

          for (var k = 0; k < winnerField.length; k++) {
            var tmpK = String(winnerField[k].trim());
            tmpString +=
              "<td>" + inExcelJSON[winnerArray[index]][tmpK] + "</td>";
          }

          setTimeout(function () {
            $(item).append(tmpString);
          }, 3000);
        });
      }

      function makeRandom(max) {
        var RandVal = Math.floor(Math.random() * max);
        return RandVal;
      }

      function checkDuple(inArray, val) {
        for (var j = 0; j < inArray.length; j++) {
          if (inArray[j] == val) {
            return false;
          }
        }
        return true;
      }
    </script>
  </body>
</html>
